@startuml process
!theme plain
title Плагин суммаризации для Mattermost - Внутренний процесс

start

:Пользователь вводит команду /summary;
:Mattermost направляет в плагин;
:Вызывается ExecuteCommand();

if (Клиент команд инициализирован?) then (нет)
  :Вернуть ошибку;
  stop
else (да)
endif

:Парсинг аргументов команды;

if (Тип команды?) then (тред)
  :Получить сообщения треда через API;
else (канал)
  :Получить сообщения канала через API;
endif

:Фильтрация и форматирование сообщений;

if (Сообщения найдены?) then (нет)
  :Вернуть "Сообщения не найдены";
  stop
else (да)
endif

:Создание структурированного запроса;
:Отправка в LLM провайдер (Ollama);

if (LLM ответил успешно?) then (нет)
  :Логировать ошибку;
  :Вернуть резервное резюме;
else (да)
  :Обработка ответа LLM;
endif

:Форматирование финального резюме;
:Возврат эфемерного ответа пользователю;

stop

@enduml
